<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wildlife Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f1f5f9;
        }

        .wildlife-gradient {
            background: linear-gradient(135deg, #064e3b 0%, #14532d 100%);
        }

        .step-inactive {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .step-active {
            opacity: 1;
            filter: none;
            transform: scale(1.02);
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #10b981;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .heatmap-overlay {
            background: radial-gradient(circle, rgba(255, 0, 0, 0.4) 0%, rgba(255, 255, 0, 0.2) 50%, transparent 70%);
            mix-blend-mode: overlay;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
    </style>
</head>

<body class="p-4 md:p-6 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Top Stats Bar -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                <p class="text-xs font-bold text-slate-400 uppercase">Total Scanned</p>
                <h3 id="stat-scanned" class="text-2xl font-bold text-slate-800">0</h3>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 border-l-4 border-l-emerald-500">
                <p class="text-xs font-bold text-slate-400 uppercase">Wildlife Detected</p>
                <h3 id="stat-detected" class="text-2xl font-bold text-emerald-600">0</h3>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                <p class="text-xs font-bold text-slate-400 uppercase">Species Identified</p>
                <h3 id="stat-species" class="text-2xl font-bold text-blue-600">0</h3>
            </div>
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                <p class="text-xs font-bold text-slate-400 uppercase">Alerts Sent</p>
                <h3 id="stat-alerts" class="text-2xl font-bold text-rose-500">0</h3>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

            <!-- Left Panel: Input & Controls (4 Cols) -->
            <div class="lg:col-span-4 space-y-6">
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-bold flex items-center gap-2">
                            <span class="p-2 bg-emerald-100 rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-600" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                            </span>
                            Sensor Input
                        </h2>
                        <span class="text-[10px] bg-emerald-50 text-emerald-600 px-2 py-1 rounded font-bold">STATION:
                            TRAP-082</span>
                    </div>

                    <div id="drop-zone"
                        class="relative border-2 border-dashed border-slate-200 rounded-2xl p-6 text-center hover:border-emerald-500 transition-all cursor-pointer bg-slate-50 group">
                        <input type="file" id="file-input" class="hidden" accept="image/*">

                        <div id="upload-prompt" class="py-10">
                            <div
                                class="bg-white text-slate-400 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3 shadow-sm group-hover:text-emerald-500 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                </svg>
                            </div>
                            <p class="text-sm font-bold text-slate-600">Select Camera Feed Image</p>
                            <p class="text-[10px] text-slate-400 mt-1 uppercase tracking-widest">Supports JPG, PNG, WEBP
                            </p>
                        </div>

                        <div id="preview-container"
                            class="hidden relative overflow-hidden rounded-xl border border-slate-200">
                            <img id="preview-img" class="w-full h-56 object-cover">
                            <div id="heatmap" class="hidden absolute inset-0 heatmap-overlay animate-pulse"></div>
                        </div>
                    </div>

                    <button id="analyze-btn" disabled
                        class="w-full mt-6 bg-slate-200 text-slate-400 font-bold py-4 rounded-xl transition-all cursor-not-allowed uppercase tracking-widest text-sm">
                        Process Framework
                    </button>
                </div>

                <!-- Action Center (New) -->
                <div id="action-center" class="bg-slate-800 p-6 rounded-3xl text-white opacity-40 transition-opacity">
                    <h3 class="text-xs font-black uppercase tracking-widest mb-4 text-emerald-400">Action Center</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="triggerAlert('Ranger')"
                            class="bg-rose-600 hover:bg-rose-700 p-3 rounded-xl text-[10px] font-bold transition-all">
                            ALERT RANGERS
                        </button>
                        <button onclick="triggerAlert('DB')"
                            class="bg-slate-700 hover:bg-slate-600 p-3 rounded-xl text-[10px] font-bold transition-all">
                            SAVE TO CLOUD
                        </button>
                    </div>
                </div>
            </div>

            <!-- Middle Panel: Pipeline (5 Cols) -->
            <div class="lg:col-span-5 space-y-6">
                <!-- Stage 1 & 2 Combined View -->
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                        <h3 class="font-bold text-slate-800">Inference Pipeline</h3>
                        <div id="pipeline-status" class="flex gap-2">
                            <div class="w-2 h-2 rounded-full bg-slate-300"></div>
                            <div class="w-2 h-2 rounded-full bg-slate-300"></div>
                        </div>
                    </div>

                    <div class="p-6 space-y-8">
                        <!-- Binary -->
                        <div id="stage-1" class="transition-all duration-300 step-inactive">
                            <div class="flex items-start gap-4">
                                <div
                                    class="bg-blue-600 text-white w-6 h-6 rounded-lg flex items-center justify-center font-bold text-[10px]">
                                    1</div>
                                <div class="flex-1">
                                    <div class="flex justify-between mb-1">
                                        <h4 class="text-xs font-bold text-slate-700">WILDLIFE DETECTION</h4>
                                        <span id="status-1" class="text-[10px] text-slate-400 font-mono">IDLE</span>
                                    </div>
                                    <div id="result-1"
                                        class="hidden mt-2 p-3 bg-slate-50 rounded-xl border border-slate-100 flex items-center justify-between">
                                        <span id="detect-text" class="text-xs font-bold"></span>
                                        <span id="detect-conf"
                                            class="text-[10px] bg-white px-2 py-1 rounded-md border border-slate-200"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Multiclass -->
                        <div id="stage-2" class="transition-all duration-300 step-inactive">
                            <div class="flex items-start gap-4">
                                <div
                                    class="bg-blue-600 text-white w-6 h-6 rounded-lg flex items-center justify-center font-bold text-[10px]">
                                    2</div>
                                <div class="flex-1">
                                    <div class="flex justify-between mb-1">
                                        <h4 class="text-xs font-bold text-slate-700">SPECIES IDENTIFICATION</h4>
                                        <span id="status-2" class="text-[10px] text-slate-400 font-mono">IDLE</span>
                                    </div>
                                    <div id="result-2" class="hidden mt-2">
                                        <div
                                            class="bg-emerald-50 p-4 rounded-xl border border-emerald-100 flex items-center justify-between">
                                            <div>
                                                <h5 id="species-name" class="text-xl font-black text-emerald-900">Tiger
                                                </h5>
                                                <p id="species-conf" class="text-[10px] font-bold text-emerald-600">98%
                                                    Match</p>
                                            </div>
                                            <div class="text-right">
                                                <p class="text-[9px] text-emerald-400 font-bold uppercase">Location Tag
                                                </p>
                                                <p id="mock-coords"
                                                    class="text-[10px] text-emerald-700 font-mono italic">24.5N, 81.2E
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Log Console -->
                <div id="system-log"
                    class="bg-slate-900 rounded-2xl p-4 font-mono text-[9px] text-emerald-500 h-32 overflow-y-auto custom-scrollbar shadow-inner border border-slate-800">
                    <p class="text-slate-500 opacity-50 italic">System Ready. Waiting for input stream...</p>
                </div>
            </div>

            <!-- Right Panel: History & Gallery (3 Cols) -->
            <div class="lg:col-span-3">
                <div class="bg-white h-full rounded-3xl shadow-sm border border-slate-200 p-6">
                    <h3
                        class="text-xs font-black uppercase tracking-widest mb-6 text-slate-400 flex items-center justify-between">
                        Recent History
                        <span id="history-count" class="bg-slate-100 px-2 py-0.5 rounded-full text-[10px]">0</span>
                    </h3>
                    <div id="history-list" class="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar">
                        <!-- History items added here -->
                        <div id="empty-history" class="text-center py-20">
                            <p class="text-xs text-slate-300 italic">No previous detections in this session.</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // DOM Elements
        const fileInput = document.getElementById('file-input');
        const dropZone = document.getElementById('drop-zone');
        const previewImg = document.getElementById('preview-img');
        const previewContainer = document.getElementById('preview-container');
        const uploadPrompt = document.getElementById('upload-prompt');
        const analyzeBtn = document.getElementById('analyze-btn');
        const log = document.getElementById('system-log');
        const heatmap = document.getElementById('heatmap');
        const actionCenter = document.getElementById('action-center');

        // State Tracking
        const stats = { scanned: 0, detected: 0, species: new Set(), alerts: 0 };
        const speciesList = [
            { name: 'Bengal Tiger', tag: 'ENDANGERED', color: 'rose' },
            { name: 'Asian Elephant', tag: 'PROTECTED', color: 'emerald' },
            { name: 'Indian Leopard', tag: 'ENDANGERED', color: 'amber' },
            { name: 'Spotted Deer', tag: 'COMMON', color: 'blue' },
            { name: 'Wild Boar', tag: 'COMMON', color: 'slate' }
        ];

        // UI Helpers
        const setStep = (num, state) => {
            const el = document.getElementById(`stage-${num}`);
            const status = document.getElementById(`status-${num}`);
            if (state === 'active') {
                el.classList.remove('step-inactive');
                el.classList.add('step-active');
                status.innerHTML = `<div class="loader"></div>`;
            } else if (state === 'complete') {
                status.innerText = 'DONE';
            } else {
                el.classList.add('step-inactive');
                el.classList.remove('step-active');
                status.innerText = 'IDLE';
            }
        };

        const updateLog = (msg, type = 'info') => {
            const p = document.createElement('p');
            const time = new Date().toLocaleTimeString([], { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            p.innerHTML = `<span class="text-slate-600">[${time}]</span> ${msg}`;
            log.appendChild(p);
            log.scrollTop = log.scrollHeight;
        };

        const updateStats = () => {
            document.getElementById('stat-scanned').innerText = stats.scanned;
            document.getElementById('stat-detected').innerText = stats.detected;
            document.getElementById('stat-species').innerText = stats.species.size;
            document.getElementById('stat-alerts').innerText = stats.alerts;
        };

        // File Interaction
        dropZone.onclick = () => fileInput.click();
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (re) => {
                    previewImg.src = re.target.result;
                    previewContainer.classList.remove('hidden');
                    uploadPrompt.classList.add('hidden');
                    analyzeBtn.disabled = false;
                    analyzeBtn.classList.replace('bg-slate-200', 'bg-emerald-600');
                    analyzeBtn.classList.replace('text-slate-400', 'text-white');
                    analyzeBtn.classList.remove('cursor-not-allowed');
                    resetUI();
                };
                reader.readAsDataURL(file);
            }
        };

        const resetUI = () => {
            setStep(1, 'idle'); setStep(2, 'idle');
            document.getElementById('result-1').classList.add('hidden');
            document.getElementById('result-2').classList.add('hidden');
            heatmap.classList.add('hidden');
            actionCenter.style.opacity = "0.4";
            actionCenter.classList.add('pointer-events-none');
        };

        const triggerAlert = (type) => {
            stats.alerts++;
            updateStats();
            const msg = type === 'Ranger' ? "Emergency Alert Broadcasted!" : "Data Synced to Mainframe.";
            const toast = document.createElement('div');
            toast.className = "fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-full text-xs font-bold shadow-2xl z-50 animate-bounce border border-emerald-500";
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
            updateLog(`Action: ${msg}`);
        };

        // Core Pipeline Logic
        analyzeBtn.onclick = async () => {
            analyzeBtn.disabled = true;
            stats.scanned++;
            updateStats();
            updateLog("Framework Start: Loading CNN-Binary-v4.2...");

            // Stage 1: Binary
            setStep(1, 'active');
            await new Promise(r => setTimeout(r, 1200));

            const isWildlife = Math.random() > 0.15;
            const binaryConf = (94 + Math.random() * 5).toFixed(1);

            setStep(1, 'complete');
            const res1 = document.getElementById('result-1');
            res1.classList.remove('hidden');
            document.getElementById('detect-text').innerText = isWildlife ? "Presence Detected" : "Empty Frame";
            document.getElementById('detect-conf').innerText = `${binaryConf}%`;

            if (isWildlife) {
                stats.detected++;
                updateStats();
                updateLog("Positive detection. Initializing Species Feature Map...");

                // Stage 2: Multiclass
                setStep(2, 'active');
                heatmap.classList.remove('hidden');
                await new Promise(r => setTimeout(r, 2000));

                const species = speciesList[Math.floor(Math.random() * speciesList.length)];
                stats.species.add(species.name);
                updateStats();

                setStep(2, 'complete');
                document.getElementById('result-2').classList.remove('hidden');
                document.getElementById('species-name').innerText = species.name;
                document.getElementById('species-conf').innerText = `${(92 + Math.random() * 7).toFixed(1)}% Confidence`;

                // Action Center Enable
                actionCenter.style.opacity = "1";
                actionCenter.classList.remove('pointer-events-none');

                updateLog(`Pipeline Success: ${species.name} identified.`);
                addToHistory(species.name, previewImg.src);
            } else {
                updateLog("Negative detection. Background frame discarded.");
                addToHistory("No Wildlife", previewImg.src, true);
            }

            analyzeBtn.disabled = false;
        };

        const addToHistory = (name, imgSrc, isNegative = false) => {
            const list = document.getElementById('history-list');
            const empty = document.getElementById('empty-history');
            if (empty) empty.remove();

            const item = document.createElement('div');
            item.className = "flex items-center gap-3 p-2 rounded-xl hover:bg-slate-50 transition-colors border border-transparent hover:border-slate-100 group";

            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            item.innerHTML = `
                <img src="${imgSrc}" class="w-12 h-12 rounded-lg object-cover shadow-sm">
                <div class="flex-1">
                    <p class="text-[10px] font-bold text-slate-800">${name}</p>
                    <p class="text-[8px] text-slate-400 font-mono uppercase">${time} â€¢ TRAP-082</p>
                </div>
                <div class="w-2 h-2 rounded-full ${isNegative ? 'bg-slate-300' : 'bg-emerald-500'}"></div>
            `;

            list.prepend(item);
            document.getElementById('history-count').innerText = list.children.length;
        };
    </script>
</body>

</html>